cmake_minimum_required (VERSION 2.6)
project (DSSAT)
enable_language (Fortran)

if (UNIX)
  set (osmode "LINUX")
elseif (WIN32)
  set (osmode "WINDO")
endif(UNIX)

get_filename_component (Fortran_COMPILER_NAME ${CMAKE_Fortran_COMPILER} NAME)

if (Fortran_COMPILER_NAME MATCHES "gfortran.*")
  # gfortran
  set (CMAKE_Fortran_FLAGS_RELEASE "-funroll-all-loops -fno-f2c -O3 -fd-lines-as-comments -Wuninitialized -fbounds-check -finit-character=32 -ffixed-line-length-none -ffree-line-length-none -nocpp")
  set (CMAKE_Fortran_FLAGS_DEBUG   "-fno-f2c -O0 -g -fd-lines-as-comments -Wuninitialized -fbounds-check -finit-character=32 -ffixed-line-length-none -ffree-line-length-none -nocpp")
elseif (Fortran_COMPILER_NAME MATCHES "ifort.*")
  # ifort (untested)
  set (CMAKE_Fortran_FLAGS_RELEASE "-f77rtl -O3")
  set (CMAKE_Fortran_FLAGS_DEBUG   "-f77rtl -O0 -g")
elseif (Fortran_COMPILER_NAME MATCHES "g77")
  # g77
  set (CMAKE_Fortran_FLAGS_RELEASE "-funroll-all-loops -fno-f2c -O3 -m32")
  set (CMAKE_Fortran_FLAGS_DEBUG   "-fno-f2c -O0 -g -m32")
else (Fortran_COMPILER_NAME MATCHES "gfortran.*")
  message ("CMAKE_Fortran_COMPILER full path: " ${CMAKE_Fortran_COMPILER})
  message ("Fortran compiler: " ${Fortran_COMPILER_NAME})
  message ("No optimized Fortran compiler flags are known, we just try -O2...")
  set (CMAKE_Fortran_FLAGS_RELEASE "-O2")
  set (CMAKE_Fortran_FLAGS_DEBUG   "-O0 -g")
endif (Fortran_COMPILER_NAME MATCHES "gfortran.*")

add_executable("dscsm046" VEGGR.for
  PET.for
  SC_OUTPUT.for
  CSP_CANOPY.for
  NCHECK_organic.for
  CSCERES_Interface.for
  OpPlantP.for
  CSP_GROW_CANE.for
  IPMAN.for
  MZ_IX_LEAFAREA.for
  NCHECK_C.for
  TR_Transpl_g.for
  WH_APSIM.FOR
  CSUTS.for
  ML_NFACT.for
  RI_Grosub.for
  CSP_PHENOL.for
  Ipphenol.for
  CRSIMDEF.for
  RI_Nfacto.for
  LAND.for
  MZ_OPGROW.for
  MgmtOps.for
  IPECO.for
  RI_KUPTAK.for
  IPVAR.for
  ttutil/rdslog.for
  ttutil/rdacha.for
  ttutil/rdstim.for
  ttutil/addstf.for
  ttutil/TIMER2.for
  ttutil/ttutil.f90
  ttutil/rdfdor.for
  ttutil/rdftim.for
  ttutil/addref.for
  ttutil/addrea.for
  ttutil/rdarea.for
  ttutil/fatalerr.f90
  ttutil/wrstim.for
  ttutil/rddata.for
  ttutil/wrslog.for
  ttutil/rdsint.for
  ttutil/rderr.for
  ttutil/rdfrom.for
  ttutil/wrarea.for
  ttutil/reaand.for
  ttutil/entdou.for
  ttutil/entdti.for
  ttutil/ifindc.f90
  ttutil/wrscha.for
  ttutil/decchk.for
  ttutil/INSW.for
  ttutil/getun.for
  ttutil/dectim.for
  ttutil/dtdpar.for
  ttutil/entdyn.for
  ttutil/rdaint.for
  ttutil/openlogf.f90
  ttutil/rdsdou.for
  ttutil/rdinqr2.for
  ttutil/messini.f90
  ttutil/parsword.for
  ttutil/dtardp.for
  ttutil/decint.for
  ttutil/rdsets.for
  ttutil/rdtmp1.for
  ttutil/decrea.for
  ttutil/wradou.for
  ttutil/rdalog.for
  ttutil/dtdpst.for
  ttutil/notnul.for
  ttutil/rdinit.for
  ttutil/wralog.for
  ttutil/rdmtim.for
  ttutil/rdinne.for
  ttutil/ambusy.for
  ttutil/rdsrer.for
  ttutil/getrec.for
  ttutil/decdou.for
  ttutil/swpi4.for
  ttutil/unifl.for
  ttutil/rdinqr3.for
  ttutil/rdainr.for
  ttutil/wraint.for
  ttutil/recread.f90
  ttutil/rdmcha.for
  ttutil/rdinqr.for
  ttutil/warning_OR.for
  ttutil/addstr.for
  ttutil/rdfrea.for
  ttutil/outplt.for
  ttutil/entddo.for
  ttutil/delfil.for
  ttutil/movavr.for
  ttutil/outdat.f90
  ttutil/rdscha.for
  ttutil/rdmdou.for
  ttutil/rdmrea.for
  ttutil/wrsdou.for
  ttutil/dtfsedp.for
  ttutil/sfindg.for
  ttutil/rdsrea.for
  ttutil/wratim.for
  ttutil/dtleap.for
  ttutil/LIMIT.for
  ttutil/rdadou.for
  ttutil/remove.for
  ttutil/rdmdef.for
  ttutil/rdfcha.for
  ttutil/upperc.f90
  ttutil/entyno.for
  ttutil/rdtmp2.for
  ttutil/sortin.for
  ttutil/rdflog.for
  ttutil/rderri.for
  ttutil/rddtmp.for
  ttutil/iunifl.for
  ttutil/outsel.f90
  ttutil/entint.for
  ttutil/addinf.for
  ttutil/dtnow.f90
  ttutil/rchrsrc.for
  ttutil/outcom.for
  ttutil/entrea.for
  ttutil/rdatim.for
  ttutil/lint.for
  ttutil/messinq.f90
  ttutil/decrec.for
  ttutil/usedun.for
  ttutil/dtfsecmp.for
  ttutil/getun2.for
  ttutil/rdfrer.for
  ttutil/messwrt.for
  ttutil/sortch.for
  ttutil/ttuver.for
  ttutil/entdin.for
  ttutil/istart.for
  ttutil/rdmlog.for
  ttutil/fopens.for
  ttutil/rdlex.for
  ttutil/wracha.for
  ttutil/str_copy.for
  ttutil/copfl2.for
  ttutil/lowerc.for
  ttutil/extens.for
  ttutil/rdinlv.for
  ttutil/rdfint.for
  ttutil/ver4_23.for
  ttutil/rdsctb.for
  ttutil/dtsys.for
  ttutil/rdindt.for
  ttutil/LINT2.for
  ttutil/rdindx.for
  ttutil/enthlp.for
  ttutil/enttim.for
  ttutil/reanor.for
  ttutil/rdinar.for
  ttutil/recreadt.f90
  ttutil/recreadi.f90
  ttutil/entdch.for
  ttutil/rdpars.for
  ttutil/words.for
  ttutil/rdador.for
  ttutil/fopengstandard.f90
  ttutil/rdsinr.for
  ttutil/addint.for
  ttutil/rdfinr.for
  ttutil/entcha.for
  ttutil/outar2.for
  ttutil/ifindi.for
  ttutil/entdre.for
  ttutil/flname.for
  ttutil/INTGRL.for
  ttutil/rdarer.for
  ttutil/wrsrea.for
  ttutil/wrinit.for
  ttutil/rdfdou.for
  ttutil/rdsdor.for
  ttutil/flexist.for
  ttutil/ttutilprefs.f90
  ttutil/rdmint.for
  ttutil/wrsint.for
  CSP_RESPIR.for
  OPSTRESS.for
  SEFERT.for
  Opgrow.for
  CROPGRO.for
  PT_OPGROW.for
  TR_Tillsub.for
  PARTIT_C.for
  TR_Nuptak.for
  SoilPi.for
  FCHEM.for
  CSP_GROW.for
  Flood_Irrig.for
  SG_PHENOL.for
  P_IPPLNT.for
  RETC_VG.for
  MULCHLAYER.for
  SOMINIT_c.for
  TR_Phenol.for
  WH_temp.for
  SoilNoBal_C.for
  IPHedley_inorg.for
  TillEvent.for
  RI_GNURSE.for
  optempy2k.for
  SC_Canop3.for
  MULCHEVAP.for
  ML_PHENOL.for
  SECROP.for
  WTHMOD.for
  FREEZE.for
  SoilMixing.for
  SATFLO.for
  RI_Transpl_p.for
  OpSoilPi.for
  WH_OPNIT.FOR
  HRes_CGRO.for
  WBSUBS.for
  CSP_CASUPRO.for
  SoilNoBal.for
  SEIRR.for
  SEWTH.for
  SALUS/SALUS_Roots.f90
  SALUS/SALUS_Opgrow.f90
  SALUS/SALUS_Opharv.f90
  SALUS/SALUS.f90
  SALUS/SALUS_NPuptake.f90
  SALUS/SALUS_Subs.f90
  WH_ROOTS.FOR
  SEHARV.for
  SG_CERES.for
  RI_Opharv.for
  IPWTH_alt.for
  OpFlood.for
  NUPTAK.for
  WH_module.f90
  SoilNi_init.for
  SC_PARTIT.for
  MZ_PHENOL.for
  GROW.for
  OpSoilKi.for
  Warning.for
  RI_Tillsub.for
  WTHSET.for
  SoilKi.for
  plant.for
  TSOMLIT_C.for
  INCORPOR_C.for
  SETIME.for
  SOILEV.for
  Tillage.for
  OPWBAL.for
  RunList.for
  SEFREQ.for
  Flood_Chem.for
  ML_OPGROW.FOR
  SEINIT.for
  PEST.for
  CSP_MOBIL.for
  OPHEAD.for
  CSP_ROOTS.for
  SEFLD.for
  SDCOMP.for
  NCHECK_inorg.for
  RStages.for
  ESR_SoilEvap.for
  SW_FreshWt.for
  RI_Ipcrop.for
  sg_NUPTAK.for
  SG_ROOTGR.for
  SoilK_init.for
  RI_Transpl_g.for
  AUTPLT.for
  CSP_VEGGR.for
  SEPLT.for
  SG_OPHARV.for
  IPCHEM.for
  MZ_IX_RADABS.for
  OPSOMLIT_C.for
  PHOTO.for
  CSDISEASE.for
  PT_ROOTGR.for
  CSP_PHOTO.for
  CSP_DEMAND.for
  INVAR.for
  EQUIL2.for
  MZ_IX_PHENOL.for
  IPHedley_C.for
  input_sub.for
  STEMP_EPIC.for
  MZ_IX_RESPIR.for
  DEMAND.for
  SG_PHASEI.for
  WBAL.for
  MZ_IX_PHOTSYNT.for
  CSP_INCOMP.for
  SC_CanesimCanopy.for
  TRANS.for
  INTRO.for
  ML_opharv.for
  TR_SUBSTOR.for
  SoilNiBal.for
  SoilPBalSum.for
  OPETPHOT.for
  SC_COEFFS.for
  OPPEST.for
  IPENV.for
  PT_GROSUB.for
  SC_ROOTG.for
  WGEN.for
  SoilPi_init.for
  Info.for
  EFLOW_C.for
  RICE.for
  MZ_OPNIT.for
  ipexp.for
  HResCeres.for
  PT_PHASEI.for
  OP_OBS/OPNF.f90
  OP_OBS/OBSSYS.f90
  OP_OBS/OPSC.f90
  OP_OBS/INTGR2.f90
  OP_OBS/TTHEAD.f90
  OP_OBS/DS1900.f90
  OP_OBS/OPWRITE.f90
  OP_OBS/OPSYS.f90
  OP_OBS/OPREAD.f90
  OP_OBS/OPINIT.f90
  OP_OBS/OPCF.f90
  OP_OBS/INQOBS.f90
  OP_OBS/OBSTRG.f90
  OP_OBS/OPSTOR.f90
  OP_OBS/GETOBS.f90
  OP_OBS/INDEXX.f90
  OP_OBS/OBSINI.f90
  ROOTDM.for
  WH_PHENOL.for
  WH_GROSUB.for
  ETPHR.for
  IPSOIL_Inp.for
  RI_Opgrow.for
  SC_Poplt3.for
  ML_GROSUB.for
  PT_NUPTAK.for
  SESIM.for
  CO2VAL.for
  IPPROG.for
  OPHARV.for
  MZ_IX_PLANTG.for
  IPSIM.for
  SERES.for
  P_CASUPRO.for
  SW_GROSUB.for
  SEPEST.for
  SPAM.for
  MZ_GROSUB.for
  SC_PHOTOS.for
  IPPLNT.for
  RPLACE_C.for
  SOMLITPRINT_C.for
  MZ_IX_KNUMBER.for
  OPTEMPXY2K.for
  SG_GROSUB.for
  SoilPoBal.for
  PODDET.for
  SAL_Stemp.for
  PT_PHENOL.for
  SEVAR.for
  SENS.for
  ERROR.for
  READS.for
  STEMP.for
  CSCRP.for
  CSCER.for
  MZ_KUPTAK.for
  OPGEN.for
  RNOFF.for
  INCOMP.for
  WH_SW_SUBS.for
  TR_Calcshk.for
  PT_NFACTO.for
  OPFLOODN.for
  SOMFIX_C.for
  ASMDM.for
  RI_Nuptak.for
  NFIX.for
  SoilOrg.for
  OM_Place.for
  SPSUBS.for
  WH_COLD.for
  PODS.for
  CSCRP_Interface.for
  OPGeneric.for
  SG_NFACT.for
  ModuleDefs.for
  CENTURY.for
  AUTHAR.for
  WH_OPHARV.FOR
  ML_PHASEI.for
  P_Uptake.for
  ML_TILLSUB.for
  ORYZA/wnostress.f90
  ORYZA/SRDPRF.f90
  ORYZA/Ncrop3.f90
  ORYZA/OR_Opharv.for
  ORYZA/OR_Opgrow.f90
  ORYZA/SASTRO.f90
  ORYZA/GPPARSET.f90
  ORYZA/VARIABLE.f90
  ORYZA/SVPS1.f90
  ORYZA/G_Exper.f90
  ORYZA/SGPL.f90
  ORYZA/SGPC1.f90
  ORYZA/ORYZA1.f90
  ORYZA/NightT.f90
  ORYZA/quadpack.f90
  ORYZA/WStress2.f90
  ORYZA/SGPCDT.f90
  ORYZA/SUBCBC.f90
  ORYZA/GPPARGET.f90
  ORYZA/SGPC2.f90
  ORYZA/Nnostress2.f90
  ORYZA/PARTITION.f90
  ORYZA/SUBGRN.f90
  ORYZA/SUBCD2.f90
  ORYZA/OR_PHENOL.f90
  ORYZA/G_Soil.f90
  ORYZA/SUBLAI3.f90
  ORYZA/ORYZA_Interface.f90
  ORYZA/OR_ROOTG.f90
  ORYZA/SUBDD.f90
  ORYZA/SSKYC.f90
  IPSLIN.for
  CSP_NUPTAK.for
  OPSOILNI.for
  HMET.for
  weathr.for
  OpStemp.for
  RI_Phenol.for
  TR_Transpl_p.for
  OPVIEW.for
  CSP_IPPHENOL.for
  RI_Calcshk.for
  SC_CNG_mods.for
  PT_OPHARV.for
  SLigCeres.for
  P_CERES.for
  WEATHR_Inp.for
  SC_PHENOL.for
  VEGDM.for
  OPWEATH.for
  SoilCNPinit_C.for
  MZ_OPHARV.for
  ETPHOT.for
  CSP_IPDMND_OUT.for
  WH_NUPTAK.FOR
  INFIL.for
  DATES.for
  WATBAL.for
  CSP_INCOMP_OUT.for
  ROOTWU.for
  SoilCBal_C.for
  PT_THTIME.for
  PESTCP.for
  CHEMICAL.for
  IRRIG.for
  CSP_INPHENOL.for
  IPPEST.for
  SOIL.for
  SENES.for
  TR_Opharv.for
  PlantNBal.for
  TR_OPGROW.for
  RootSoilVol.for
  PPlantSubs.for
  CANOPY.for
  DECRAT_C.for
  CSCAS.for
  CSP_OPHARV.for
  TR_Nfacto.for
  TR_Grosub.for
  IPTILL.for
  CE_RATIO_C.for
  SoilOrg_init.for
  SECLI.for
  UTILS.for
  SOILDYN.for
  PT_SUBSTOR.for
  TextureClass.for
  MULCHWAT.for
  SoilNoPoBal.for
  TR_Ipcrop.for
  FreshWt.for
  OpSoilOrg.for
  FLOODI.for
  TR_Rootgr.for
  CSP_HRes.for
  CSREADS.for
  Fert_Place.for
  MZ_IX_NUPTAK.for
  WH_KUPTAK.FOR
  MZ_IX_GROSUB.for
  INSTGE.for
  P_CGRO.for
  SOLAR.for
  SOMDEC_C.for
  PATH.for
  WH_NFACTO.for
  SC_OPHARV.for
  TILEDRAIN.for
  ROOTS.for
  MZ_CERES.for
  ml_NUPTAK.for
  MZ_NUPTAK.for
  SESOIL.for
  IPPARM.for
  LINDM.for
  soilpibal.for
  CSP_OPGROW.for
  ML_CERES.for
  CSP_IPPLNT.for
  RI_Rootgr.for
  ML_rootgr.for
  IPIBS.for
  Paddy_Mgmt.for
  SOILNI.for
  IPSOIL.for
  CSP_SENES.for
  NFLUX.for
  SC_CNGRO.for
  SoilPoBal_C.for
  p_plant.for
  LMATCH.for
  SEEDDM.for
  OXLAYER.for
  MZ_ROOTS.for
  LITDEC_C.for
  SoilNBalSum.for
  INSOIL.for
  SENESADD_C.for
  WH_OPGROW.FOR
  CSCAS_Interface.for
  RESPIR.for
  IMMOBLIMIT_C.for
  MZ_NFACTO.for
  CSM.for
  PHENOL.for
  MOBIL.for
  OPSUM.for
  OPMULCH.for )

install(DIRECTORY Data/
  DESTINATION bin
  PATTERN "Data/*"
  )

install(TARGETS dscsm046
  RUNTIME DESTINATION bin)
